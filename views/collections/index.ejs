<%- layout('layouts/boilerplate') %>

  <div class="table-responsive my-5 mx-3">
    <h1 class="text-center">Collection</h1>
    <table class="table table-striped table-hover align-middle caption-top">
      <caption>Click on any row for more detail (button and functionality don't work just pops ups modal currently):
      </caption>
      <thead class="table-primary">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Item Image</th>
          <th scope="col">Item Name</th>
          <th scope="col">Item Description</th>
          <th scope="col">Purchase Date</th>
          <th scope="col">Purchase Price</th>
        </tr>
      </thead>
      <tbody>
        <% for ( let res of results ) {%>
          <tr data-bs-toggle="modal" data-bs-target="#myModal" data-name="<%= res.Item_Name %>"
            data-desc="<%= res.Item_Description %>" data-img="assets/img/<%= res.Item_Img_Name%>">
            <th scope="row">
              <%= res.Item_ID %>
            </th>
            <td>
              <img src="assets/img/<%= res.Item_Img_Name%>" alt="" height="50px">
            </td>
            <td>
              <%= res.Item_Name %>
            </td>
            <td>
              <%= res.Item_Description %>
            </td>
            <td>
              <%= res.Item_Purch_Date.toDateString() %>
            </td>
            <td>
              $<%= res.Item_Purch_Price.toFixed(2) %>
            </td>
          </tr>
          <% }%>


            <!-- TODO: Need to add in form functionality to allow adding to DB, also set up DB correctly   -->
            <!-- Modal For Editing Collection-->
            <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header flex-column">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <h5 class="modal-title" id="exampleModalLabel"></h5>
                    <div>
                      <img src="" alt="" id="modalImg" width="100%">
                    </div>
                  </div>
                  <div class="modal-body text-center">
                    Not sure if I can make this work dynamically...
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                  </div>
                </div>
              </div>
            </div>
      </tbody>
    </table>
  </div>


  <!-- Script to dynamically add collection items in the row that is clicked on into the Modal: -->
  <script>
    var myModal = document.getElementById('myModal');
    var myInput = document.getElementById('myInput');

    myModal.addEventListener('shown.bs.modal', function () {
      // Trigger for the Modal:
      var row = event.relatedTarget;

      // Extract info from the data-* attributes I set up:
      var itemName = row.getAttribute('data-name');
      var itemDesc = row.getAttribute('data-desc');
      var itemImg = row.getAttribute('data-img');

      // Update the modal's content.
      var modalTitle = myModal.querySelector('.modal-title')
      var myInput = myModal.querySelector('.modal-body')
      var myImg = myModal.querySelector('#modalImg').src = itemImg;

      modalTitle.textContent = itemName;
      myInput.textContent = itemDesc;
      // myInput.focus();
    });
  </script>